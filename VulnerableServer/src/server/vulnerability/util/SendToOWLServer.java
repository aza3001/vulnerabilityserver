package server.vulnerability.util;

import java.io.IOException;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;
import java.net.ServerSocket;
import java.net.Socket;
import java.util.ArrayList;

import monitor.storage.information.agent.storage.AppAndDef;
import monitor.storage.information.agent.storage.OSDependentDef;

public class SendToOWLServer {
	private static Socket s = null;
	private static ServerSocket server = null;
	private static ObjectInputStream in = null;
	private static ObjectOutputStream out = null;
	private static ArrayList<AppAndDef> aad = null;
	
	@SuppressWarnings("unchecked")
	public static ArrayList<AppAndDef> sendResultToVulServer ( String os ) {
		int port = 2010;
		
		while(true){
			try{
				aad = new ArrayList<AppAndDef>();
				s = new Socket("localhost", port); //need server ip and port in here
				s.setSoTimeout(60000);
				
				out = new ObjectOutputStream(s.getOutputStream());
				out.writeObject( "os:" + os );
				out.flush();
				
				in = new ObjectInputStream( s.getInputStream() );
				aad = (ArrayList<AppAndDef>) in.readObject();
				out.close();
				in.close();
				
				if (aad != null)
					break;
				else {
					if (port < 2016)
						port++;
					else
						port = 2010;
				}
			}catch (Exception e) {
				// TODO: handle exception
				e.printStackTrace();
				
			} 
			try {
				if (in != null){in.close();}
				if (s != null) {s.close();}
			} catch (IOException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
		}
		return aad;
	}
		
}
